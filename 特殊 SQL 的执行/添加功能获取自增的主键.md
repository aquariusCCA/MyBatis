---
up:
  - "[[MyBatis 課程描述]]"
---

- 使用场景
    -   `t_clazz(clazz_id, clazz_name)`
    -   `t_student(student_id, student_name, clazz_id)`
    1.  添加班级信息
    2.  获取新添加的班级的 id
    3.  为班级分配学生，即将某学的班级 id 修改为新添加的班级的 id

- 在 mapper.xml 中设置两个属性
    -   useGeneratedKeys：设置使用自增的主键
    *   keyProperty：因为增删改有统一的返回值是受影响的行数，因此只能将获取的自增的主键放在传输的参数 user 对象的某个属性中

```java
/**  
 * 添加用用户信息  
 */  
void insertUser(User user);
```

```xml
<!--  
void insertUser(User user);  
useGeneratedKeys:设置当前标签中的sql使用了自增的id  
keyProperty:将自增的主键的值赋值给传输到映射文件中参数的某个属性  
-->  
<insert id="insertUser" useGeneratedKeys="true" keyProperty="eid">  
    insert into t_user 
    values(null, #{empName}, #{password}, #{age}, #{sex}, #{email}, null)  
</insert>
```

```java
//测试类
@Test
public void insertUser() {
	SqlSession sqlSession = SqlSessionUtils.getSqlSession();
	SQLMapper mapper = sqlSession.getMapper(SQLMapper.class);
	User user = new User(null, "ton", "123", 23, "男", "123@321.com");
	mapper.insertUser(user);
	System.out.println(user);
	//输出：user{id=10, username='ton', password='123', age=23, sex='男', email='123@321.com'}，自增主键存放到了user的id属性中
}
@Test  
public void testInsertUser() {  
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();  
    SQLMapper mapper = sqlSession.getMapper(SQLMapper.class);  
    User user = new User(null, "王五", "123", 23, 1, "123@163.com", null);  
    mapper.insertUser(user);  
    System.out.println(user); 
    // 輸出：User(eid=5, empName=王五, password=123, age=23, sex=1, email=123@163.com, did=null)
    // 自增主键存放到了user的eid属性中
}
```