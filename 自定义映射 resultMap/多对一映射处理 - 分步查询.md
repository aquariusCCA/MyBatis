---
up:
  - "[[MyBatis 課程描述]]"
  - "[[多对一映射处理]]"
---
# 1. 查询员工信息

- select：设置分布查询的 sql 的唯一标识（namespace.SQLId 或 mapper 接口的全类名.方法名）

- column：设置分步查询的条件

- fetchType: 当开启了全局的延迟加载之后，可通过此属性手动控制延迟加载的效果
	- fetchType="lazy|eager": lazy表示延迟加载，eager表示立即加载

```java
//EmpMapper里的方法
/**  
 * 通过分步查询员工以及员工所对应的部门信息  
 * 分步查询第一步：查询员工信息  
 */  
Emp getEmpAndDeptByStepOne(@Param("eid") Integer eid);
```

```xml
<resultMap id="empAndDeptByStepResultMap" type="Emp">
	<id property="eid" column="eid" />
	<result property="empName" column="emp_name" />
	<result property="age" column="age" />
	<result property="sex" column="sex" />
	<result property="email" column="email" />
	<association 
		property="dept"
		select="com.atguigu.mybatis.mapper.DeptMapper.getEmpAndDeptByStepTwo"
		column="did" 
		fetchType="eager">
	</association>
</resultMap>

<!-- Emp getEmpAndDeptByStepOne(@Param("eid") Integer eid); -->
<select id="getEmpAndDeptByStepOne" resultMap="empAndDeptByStepResultMap">
	select * from t_emp where eid = #{eid}
</select>
```

---
# 2. 查询部门信息

```java
//DeptMapper里的方法
/**
 * 通过分步查询部门以及部门中所有的员工信息
 * 分步查询第二步：根据did查询员工信息
 */
List<Emp> getDeptAndEmpByStepTwo(@Param("did") Integer did);
```

```xml
<!--此处的resultMap仅是处理字段和属性的映射关系-->
<resultMap id="EmpAndDeptByStepTwoResultMap" type="Dept">
	<id property="did" column="did"></id>
	<result property="deptName" column="dept_name"></result>
</resultMap>

<!--Dept getEmpAndDeptByStepTwo(@Param("did") Integer did);-->
<select id="getEmpAndDeptByStepTwo" resultMap="EmpAndDeptByStepTwoResultMap">
	select * from t_dept where did = #{did}
</select>
```

---

# 3. 測試

```java
@Test  
public void testGetEmpAndDeptByStep() {  
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();  
    EmpMapper mapper = sqlSession.getMapper(EmpMapper.class);  
    Emp emp = mapper.getEmpAndDeptByStepOne(1);  
    System.out.println(emp.getEmpName());  
    System.out.println("++++++++++++++++++++++++++++++++++++++++++++++++");  
    System.out.println(emp.getDept());  
}
```